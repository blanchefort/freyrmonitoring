{% load bootstrap4 %}
{% load static %}
{% load leaflet_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="ie=edge">

  <title>{{title}}</title>

  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="{% static 'AdminLTE/plugins/fontawesome-free/css/all.min.css' %}">
  <script src="https://kit.fontawesome.com/80005c51be.js" crossorigin="anonymous"></script>
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'AdminLTE/dist/css/adminlte.min.css' %}">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <link rel="apple-touch-icon" sizes="57x57" href="{% static 'freyr_images/freyr.ico/apple-icon-57x57.png' %}">
  <link rel="apple-touch-icon" sizes="60x60" href="{% static 'freyr_images/freyr.ico/apple-icon-60x60.png' %}">
  <link rel="apple-touch-icon" sizes="72x72" href="{% static 'freyr_images/freyr.ico/apple-icon-72x72.png' %}">
  <link rel="apple-touch-icon" sizes="76x76" href="{% static 'freyr_images/freyr.ico/apple-icon-76x76.png' %}">
  <link rel="apple-touch-icon" sizes="114x114" href="{% static 'freyr_images/freyr.ico/apple-icon-114x114.png' %}">
  <link rel="apple-touch-icon" sizes="120x120" href="{% static 'freyr_images/freyr.ico/apple-icon-120x120.png' %}">
  <link rel="apple-touch-icon" sizes="144x144" href="{% static 'freyr_images/freyr.ico/apple-icon-144x144.png' %}">
  <link rel="apple-touch-icon" sizes="152x152" href="{% static 'freyr_images/freyr.ico/apple-icon-152x152.png' %}">
  <link rel="apple-touch-icon" sizes="180x180" href="{% static 'freyr_images/freyr.ico/apple-icon-180x180.png' %}">
  <link rel="icon" type="image/png" sizes="192x192"  href="{% static 'freyr_images/freyr.ico/android-icon-192x192.png' %}">
  <link rel="icon" type="image/png" sizes="32x32" href="{% static 'freyr_images/freyr.ico/favicon-32x32.png' %}">
  <link rel="icon" type="image/png" sizes="96x96" href="{% static 'freyr_images/freyr.ico/favicon-96x96.png' %}">
  <link rel="icon" type="image/png" sizes="16x16" href="{% static 'freyr_images/freyr.ico/favicon-16x16.png' %}">

  <link rel="stylesheet" href="{% static 'AdminLTE/plugins/daterangepicker/daterangepicker.css' %}">
  <link rel="stylesheet" href="{% static 'AdminLTE/plugins/select2/css/select2.min.css' %}">
  <link rel="stylesheet" href="{% static 'AdminLTE/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">
  
  <link rel="stylesheet" href="{% static 'AdminLTE/plugins/jsgrid/jsgrid.min.css' %}">
  <link rel="stylesheet" href="{% static 'AdminLTE/plugins/jsgrid/jsgrid-theme.min.css' %}">
  {% leaflet_js %}
  {% leaflet_css %}
  <style>
    .leaflet-container { height: 100%; width: 100%; }
  </style>
  <script>
    var dataurl = '{% static "maps/region.json" %}';

    window.addEventListener("map:init", function (event) {
      var map = event.detail.map.setView([58.1, 33.0], 6);
      // Download GeoJSON data with Ajax
      fetch(dataurl)
        .then(function(resp) {
          return resp.json();
        })
        .then(function(data) {
          L.geoJson(data, {
            onEachFeature: function onEachFeature(feature, layer) {
              var props = feature.properties;
              var content = `<img width="300" src="${props.picture_url}"/><h3>${props.NL_NAME_1}</h3><p>${props.description}</p>`;
              layer.bindPopup(props.NL_NAME_2);
          }}).addTo(map);
        });
    });
  </script>
</head>
<body class="hold-transition sidebar-mini">
<div class="wrapper">

  <!-- Navbar -->
  <nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        <a href="{% url 'index' %}" class="nav-link">Главная</a>
      </li>
      <li class="nav-item d-none d-sm-inline-block">
        {% if user.is_authenticated %}
        <a href="{% url 'logout' %}" class="nav-link">Выйти</a>
        {% else %}
        <a href="{% url 'login' %}" class="nav-link">Войти</a>
        {% endif %}
      </li>
    </ul>


  </nav>
  <!-- /.navbar -->

  <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="{% url 'index' %}" class="brand-link">
      <img src="{% static 'freyr_images/freyr_graph.png' %}" alt="AdminLTE Logo" class="brand-image img-circle elevation-3">
      <span class="brand-text font-weight-light">FreyrMonitoring</span>
    </a>

{% include 'sidebar.html' %}
  </aside>

  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <div class="content-header">
      <div class="container-fluid">
        <div class="row mb-2">
          <div class="col-sm-6">
            <h1 class="m-0 text-dark">{{page_title}}</h1>
          </div><!-- /.col -->
          <div class="col-sm-6">
            <a class="btn btn-info float-right" href="{% url 'event_excel' 1 %}">
                <i class="fas fa-download"></i>
                Скачать сводку
            </a>
          </div><!-- /.col -->
        </div><!-- /.row -->
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content-header -->

    <!-- Main content -->
    <div class="content">
      <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-7">
                {% leaflet_map "main" %}
            </div>
            <div class="col-sm-5">
                <div class="form-group">
                    <label>Категория</label>
                    <select class="form-control select2bs4" data-dropdown-css-class="select2bs4">
                        <option selected="selected">Все</option>
                        {%for cat in categories%}
                        {%if cat.name != 'Без темы' %}
                        <option>{{cat}}</option>
                        {%endif%}
                        {%endfor%}
                    </select>
                </div>
                <div class="form-group">
                    <label>Период</label>
                    <div class="input-group">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                            <i class="far fa-calendar-alt"></i>
                            </span>
                        </div>
                        <input type="text" class="form-control float-right" id="reservation">
                    </div>
                    <div class="input-group mt-5">
                        <button class="btn btn-info" type="submit">Применить</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-5 mb-2">
            <div class="col-sm-12">
                <h3>Wellbeing</h3>
                <p>Важнейшим показателем при расчёте индекса счастья (HPL) 
                    является субъективная удовлетворенность людей жизнью (Wellbeing),
                    получаемая в рамках всемирного опроса населения, проводимого Институтом Гэллапа.
                    Благодаря сбору данных из соцсетей,
                    мы можем получить данный показатель, не прибегая к опросам.
                </p>
                <p>Наш агрегированный <b>индекс удовлетворённости жизнью</b> (или одной из сфер жизни) &mdash; <b>Wellbeing</b> &mdash;
                    это показатель, рассчитываемый по шкале от 0 до 10, где 0 &mdash; полная неудовлетворённость, 10 &mdash; полная удовлетворённость.
                </p>
                <div class="card-body">
                    <div id="districts"></div>
                </div>
            </div>
        </div>
                 
      </div><!-- /.container-fluid -->
    </div>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
<!-- Main Footer -->
<footer class="main-footer">
    <!-- To the right -->
    <div class="float-right d-none d-sm-inline text-info">
      FreyrMonitoring <i class="fas fa-balance-scale-left"></i> система мониторинга общественного мнения.
    </div>
    <!-- Default to the left -->
    <strong> <a href="https://tlgg.ru/blanchefort"><i class="fas fa-cat"></i>Заказать внедрение</a>.</strong>
  </footer>
</div>
<!-- ./wrapper -->

<!-- REQUIRED SCRIPTS -->

<!-- jQuery -->
<script src="{% static 'AdminLTE/plugins/jquery/jquery.min.js' %}"></script>
<!-- Bootstrap 4 -->
<script src="{% static 'AdminLTE/plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<!-- AdminLTE App -->
<script src="{% static 'AdminLTE/dist/js/adminlte.min.js' %}"></script>

<script src="{% static 'AdminLTE/plugins/moment/moment.min.js' %}"></script>
<script src="{% static 'AdminLTE/plugins/select2/js/select2.full.min.js' %}"></script>
<script src="{% static 'AdminLTE/plugins/daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'AdminLTE/plugins/jsgrid/jsgrid.min.js' %}"></script>
<script>
    $(function () {
        $('.select2').select2()
        $('.select2bs4').select2({
            theme: 'bootstrap4'
        })
        $('#reservation').daterangepicker({
            locale: {
                format: 'DD-MM-YYYY',
                applyLabel: 'Принять',
                cancelLabel: 'Отмена',
                invalidDateLabel: 'Выберите дату',
                daysOfWeek: ['Вт', 'Ср', 'Чт', 'Пт', 'Сб', 'Вс', 'Пн'],
                monthNames: ['Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь', 'Октябрь', 'Ноябрь', 'Декабрь'],
                firstDay: 1
            }
        })

        var district_data = [
            {
                "Муниципалитет": "Великий Новгород",
                "Положительные": 50,
                "Нейтральные": 175,
                "Отрицательные": 1820,
                "Wellbeing": 72
            },
            {
                "Муниципалитет": "Старая Русса",
                "Положительные": 50,
                "Нейтральные": 175,
                "Отрицательные": 1820,
                "Wellbeing": 72
            }
        ]
        $("#districts").jsGrid({
            height: "100%",
            width: "100%",
    
            sorting: true,
    
            data: district_data,
    
            fields: [
                { name: "Муниципалитет", type: "text", width: 150 },
                { name: "Положительные", type: "number", width: 50 },
                { name: "Нейтральные", type: "number", width: 50 },
                { name: "Отрицательные", type: "number", width: 50 },
                { name: "Wellbeing", type: "number", width: 50 },
            ]
        });
    })
</script>
</body>
</html>